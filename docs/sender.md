# Sender 发送方实现

## 单文件发送
目前实现的mvp是提供目标ip地址与文件路径，能够实现单文件的发送。

### 发起传输
- [x] 在进行真正数据的传输之前，先计算文件的总哈希值（SHA256），并将相关元数据发送。
- [ ] 将哈希值计算交给线程池处理

### 文件读取
- [ ] 对于大文件 (>1GB): 使用内存映射 (Memory-Mapped Files)。在 Linux/macOS 上使用 mmap，在 Windows 上使用 CreateFileMapping 和 MapViewOfFile。内存映射可以避免将整个文件读入内存，减少内存占用和拷贝次数，并能充分利用操作系统的页面缓存。
- [x] 对于中小文件: 直接将文件读入一个缓冲区（std::vector<char>）中即可。
- [ ] 为了防止数据堆积使用多个buffer循环复用。
- [ ] 将文件io也使用asio封装到core模块。

### 数据分块与发送
- [x] 将文件（或内存映射的区域）分割成1Mb的数据块。
- [ ] 动态调整数据块大小
- [x] 为每个数据块创建一个 FileChunk 消息。

### 状态获取

对于一个数据块分为如下几种状态：
- **Waiting**: 默认状态。
- **Reading**: 正在读取。
- **Pending**: 读取、计算哈希值完毕，正在等待发送。
- **Sending**: 正在发送，等待接收完毕。
- **Sent**:  接受完毕。
- **Failed**: 失败。等待重试。

## 多文件发送
将多个文件的发送视为一个Task进行发送，共用一个socket。